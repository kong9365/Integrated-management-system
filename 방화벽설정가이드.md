# 방화벽 설정 가이드

## 문제 상황
- 현재 PC에서는 `http://172.17.6.238:5000` 접속 가능
- **회사 내부망의 다른 PC에서는 접속 불가**
- 참고: Dash 앱(포트 8057)은 다른 PC에서 접속 가능함

## 원인 분석

### Dash 앱(포트 8057)과의 차이점
1. **포트 번호 차이**: Dash는 8057, Express 서버는 5000
2. **방화벽 규칙**: 포트 8057은 이미 열려있거나 Python 실행 시 자동으로 규칙이 추가되었을 가능성
3. **포트 5000**: 방화벽이 막혀있을 가능성이 높음

### 기술적 차이점
- **Dash 앱**: `app.run(host="0.0.0.0", port=8057)` - Python으로 실행
- **Express 서버**: `app.listen(port, host)` (host='0.0.0.0', port=5000) - Node.js로 실행
- **결론**: 호스트 설정은 동일하므로, 차이점은 **포트 번호와 방화벽 설정**입니다.

## 해결 방법

### 방법 1: PowerShell 스크립트 사용 (권장)

1. **관리자 권한으로 PowerShell 실행**
   - Windows 검색에서 "PowerShell" 검색
   - "Windows PowerShell"을 **우클릭** → **"관리자 권한으로 실행"** 선택

2. **스크립트 실행**
   ```powershell
   cd "C:\Users\user\Desktop\Coding\cusor\Integrated management system"
   .\fix-firewall.ps1
   ```

3. **실행 정책 오류가 발생하는 경우**
   ```powershell
   Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
   ```
   그 다음 다시 스크립트 실행

### 방법 2: 수동으로 방화벽 규칙 추가

1. **Windows 방화벽 설정 열기**
   - Windows 검색에서 "방화벽" 검색
   - "Windows Defender 방화벽" 선택
   - "고급 설정" 클릭

2. **인바운드 규칙 추가**
   - 왼쪽 메뉴에서 "인바운드 규칙" 클릭
   - 오른쪽 "새 규칙..." 클릭
   - 규칙 종류: **"포트"** 선택 → 다음
   - 프로토콜 및 포트:
     - **TCP** 선택
     - **특정 로컬 포트**: `5000` 입력
     - 다음
   - 작업: **"연결 허용"** 선택 → 다음
   - 프로필: **모두 체크** (도메인, 개인, 공용) → 다음
   - 이름: `Node.js Server Port 5000` 입력 → 마침

### 방법 3: 명령 프롬프트 사용 (관리자 권한 필요)

```cmd
netsh advfirewall firewall add rule name="Node.js Server Port 5000" dir=in action=allow protocol=TCP localport=5000
```

## 확인 사항

### 1. 서버가 정상 실행 중인지 확인
```cmd
netstat -an | findstr ":5000"
```
결과에 `0.0.0.0:5000`이 `LISTENING` 상태로 보이면 정상입니다.

### 2. 회사 내부망 네트워크 연결 확인
- **서버 PC IP**: `172.17.6.238`
- **서브넷**: `255.255.248.0` (172.17.0.0 ~ 172.17.7.255 범위)
- **접속 가능한 PC 범위**: 같은 서브넷 내의 모든 PC (172.17.0.1 ~ 172.17.7.254)
- 다른 PC에서 서버 PC로 ping 테스트:
  ```cmd
  ping 172.17.6.238
  ```
  ping이 되면 네트워크 연결은 정상입니다.

### 3. 다른 PC에서 접속 테스트
**회사 내부망의 다른 PC**에서 브라우저로 접속:
```
http://172.17.6.238:5000
```

### 4. Dash 앱과 비교 확인
- Dash 앱(포트 8057)이 접속 가능한지 확인:
  ```
  http://172.17.6.238:8057
  ```
- 만약 Dash 앱도 접속이 안 된다면, 네트워크 문제일 수 있습니다.

### 5. 회사 내부망 특이사항
- 회사 네트워크는 보통 **도메인 프로필**로 설정되어 있습니다
- 방화벽 규칙 추가 시 **도메인 프로필**을 반드시 체크하세요
- 일부 회사에서는 추가 보안 소프트웨어가 방화벽을 관리할 수 있습니다

## 추가 문제 해결

### 방화벽 규칙이 추가되었는데도 접속이 안 되는 경우

1. **방화벽 규칙이 활성화되어 있는지 확인**
   ```powershell
   Get-NetFirewallRule -DisplayName "Node.js Server Port 5000"
   ```
   `Enabled`가 `True`인지 확인

2. **회사 내부망 환경 확인**
   - 같은 서브넷(172.17.0.0 ~ 172.17.7.255)에 있는지 확인
   - 다른 PC에서 서버 PC로 ping 테스트: `ping 172.17.6.238`
   - 회사 네트워크 정책상 추가 방화벽이 있는지 IT 부서에 문의
   - 추가 방화벽 소프트웨어(시만텍, 카스퍼스키 등)가 설치되어 있는지 확인

3. **서버 재시작**
   - 방화벽 규칙 추가 후 서버를 재시작해보세요

4. **포트 변경 고려**
   - 포트 5000이 회사 정책상 막혀있을 수 있습니다
   - 포트 8057처럼 이미 열려있는 포트로 변경하는 것도 방법입니다
   - 서버 코드에서 포트를 변경하려면:
     ```typescript
     const port = parseInt(process.env.PORT || '8050', 10);  // 5000 → 8050으로 변경
     ```

## 참고 정보

- 서버 IP: `172.17.6.238`
- 포트: `5000` (변경 가능)
- 서브넷 마스크: `255.255.248.0`
- 기본 게이트웨이: `172.17.0.254`
- Dash 앱 포트: `8057` (참고용 - 이미 접속 가능)
